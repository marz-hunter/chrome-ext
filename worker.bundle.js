(()=>{"use strict";var e,n;!function(e){e[e.Include=0]="Include",e[e.None=1]="None"}(e||(e={})),function(e){e[e.Required=0]="Required",e[e.Ignore=1]="Ignore"}(n||(n={}));var t,r,o,c,a,i,f,d;function s(){const e=new Uint8Array(32);return crypto.getRandomValues(e),function(e,n,r){let o="";for(let c=0;c<e.byteLength;c+=3){let a=0,i=0;for(let n=0;n<3&&c+n<e.byteLength;n++)a=a<<8|e[c+n],i+=8;for(let e=0;e<4;e++)i>=6?(o+=n[a>>i-6&63],i-=6):i>0?(o+=n[a<<6-i&63],i=0):r===t.Include&&(o+="=")}return o}(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",t.None)}!function(e){e[e.Include=0]="Include",e[e.None=1]="None"}(t||(t={})),function(e){e[e.Required=0]="Required",e[e.Ignore=1]="Ignore"}(r||(r={})),new class{uint8(e,n){if(e.byteLength<n+1)throw new TypeError("Insufficient bytes");return e[n]}uint16(e,n){if(e.byteLength<n+2)throw new TypeError("Insufficient bytes");return e[n]<<8|e[n+1]}uint32(e,n){if(e.byteLength<n+4)throw new TypeError("Insufficient bytes");let t=0;for(let r=0;r<4;r++)t|=e[n+r]<<24-8*r;return t}uint64(e,n){if(e.byteLength<n+8)throw new TypeError("Insufficient bytes");let t=0n;for(let r=0;r<8;r++)t|=BigInt(e[n+r])<<BigInt(56-8*r);return t}putUint8(e,n,t){if(e.length<t+1)throw new TypeError("Not enough space");if(n<0||n>255)throw new TypeError("Invalid uint8 value");e[t]=n}putUint16(e,n,t){if(e.length<t+2)throw new TypeError("Not enough space");if(n<0||n>65535)throw new TypeError("Invalid uint16 value");e[t]=n>>8,e[t+1]=255&n}putUint32(e,n,t){if(e.length<t+4)throw new TypeError("Not enough space");if(n<0||n>4294967295)throw new TypeError("Invalid uint32 value");for(let r=0;r<4;r++)e[t+r]=n>>8*(3-r)&255}putUint64(e,n,t){if(e.length<t+8)throw new TypeError("Not enough space");if(n<0||n>18446744073709551615n)throw new TypeError("Invalid uint64 value");for(let r=0;r<8;r++)e[t+r]=Number(n>>BigInt(8*(7-r))&0xffn)}},new class{uint8(e,n){if(e.byteLength<n+1)throw new TypeError("Insufficient bytes");return e[n]}uint16(e,n){if(e.byteLength<n+2)throw new TypeError("Insufficient bytes");return e[n]|e[n+1]<<8}uint32(e,n){if(e.byteLength<n+4)throw new TypeError("Insufficient bytes");let t=0;for(let r=0;r<4;r++)t|=e[n+r]<<8*r;return t}uint64(e,n){if(e.byteLength<n+8)throw new TypeError("Insufficient bytes");let t=0n;for(let r=0;r<8;r++)t|=BigInt(e[n+r])<<BigInt(8*r);return t}putUint8(e,n,t){if(e.length<1+t)throw new TypeError("Insufficient space");if(n<0||n>255)throw new TypeError("Invalid uint8 value");e[t]=n}putUint16(e,n,t){if(e.length<2+t)throw new TypeError("Insufficient space");if(n<0||n>65535)throw new TypeError("Invalid uint16 value");e[t+1]=n>>8,e[t]=255&n}putUint32(e,n,t){if(e.length<4+t)throw new TypeError("Insufficient space");if(n<0||n>4294967295)throw new TypeError("Invalid uint32 value");for(let r=0;r<4;r++)e[t+r]=n>>8*r&255}putUint64(e,n,t){if(e.length<8+t)throw new TypeError("Insufficient space");if(n<0||n>18446744073709551615n)throw new TypeError("Invalid uint64 value");for(let r=0;r<8;r++)e[t+r]=Number(n>>BigInt(8*r)&0xffn)}},new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),new BigUint64Array([0x428a2f98d728ae22n,0x7137449123ef65cdn,0xb5c0fbcfec4d3b2fn,0xe9b5dba58189dbbcn,0x3956c25bf348b538n,0x59f111f1b605d019n,0x923f82a4af194f9bn,0xab1c5ed5da6d8118n,0xd807aa98a3030242n,0x12835b0145706fben,0x243185be4ee4b28cn,0x550c7dc3d5ffb4e2n,0x72be5d74f27b896fn,0x80deb1fe3b1696b1n,0x9bdc06a725c71235n,0xc19bf174cf692694n,0xe49b69c19ef14ad2n,0xefbe4786384f25e3n,0x0fc19dc68b8cd5b5n,0x240ca1cc77ac9c65n,0x2de92c6f592b0275n,0x4a7484aa6ea6e483n,0x5cb0a9dcbd41fbd4n,0x76f988da831153b5n,0x983e5152ee66dfabn,0xa831c66d2db43210n,0xb00327c898fb213fn,0xbf597fc7beef0ee4n,0xc6e00bf33da88fc2n,0xd5a79147930aa725n,0x06ca6351e003826fn,0x142929670a0e6e70n,0x27b70a8546d22ffcn,0x2e1b21385c26c926n,0x4d2c6dfc5ac42aedn,0x53380d139d95b3dfn,0x650a73548baf63den,0x766a0abb3c77b2a8n,0x81c2c92e47edaee6n,0x92722c851482353bn,0xa2bfe8a14cf10364n,0xa81a664bbc423001n,0xc24b8b70d0f89791n,0xc76c51a30654be30n,0xd192e819d6ef5218n,0xd69906245565a910n,0xf40e35855771202an,0x106aa07032bbd1b8n,0x19a4c116b8d2d0c8n,0x1e376c085141ab53n,0x2748774cdf8eeb99n,0x34b0bcb5e19b48a8n,0x391c0cb3c5c95a63n,0x4ed8aa4ae3418acbn,0x5b9cca4f7763e373n,0x682e6ff3d6b2b8a3n,0x748f82ee5defb2fcn,0x78a5636f43172f60n,0x84c87814a1f0ab72n,0x8cc702081a6439ecn,0x90befffa23631e28n,0xa4506cebde82bde9n,0xbef9a3f7b2c67915n,0xc67178f2e372532bn,0xca273eceea26619cn,0xd186b8c721c0c207n,0xeada7dd6cde0eb1en,0xf57d4f7fee6ed178n,0x06f067aa72176fban,0x0a637dc5a2c898a6n,0x113f9804bef90daen,0x1b710b35131c471bn,0x28db77f523047d84n,0x32caab7b40c72493n,0x3c9ebe0a15c9bebcn,0x431d67c49c100d4cn,0x4cc5d4becb3e42b6n,0x597f299cfc657e2an,0x5fcb6fab3ad6faecn,0x6c44198c4a475817n]),Error,Error,Error,Error,(c=o||(o={}))[c.S256=0]="S256",c[c.Plain=1]="Plain",function(e){e[e.Include=0]="Include",e[e.None=1]="None"}(a||(a={})),function(e){e[e.Required=0]="Required",e[e.Ignore=1]="Ignore"}(i||(i={})),function(e){e[e.Include=0]="Include",e[e.None=1]="None"}(f||(f={})),function(e){e[e.Required=0]="Required",e[e.Ignore=1]="Ignore"}(d||(d={}));var u=function(e,n,t,r){return new(t||(t=Promise))((function(o,c){function a(e){try{f(r.next(e))}catch(e){c(e)}}function i(e){try{f(r.throw(e))}catch(e){c(e)}}function f(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,i)}f((r=r.apply(e,n||[])).next())}))};function b(e,n,t){return u(this,void 0,void 0,(function*(){let r,o=new Headers(t.headers);o.append("Content-Type","application/json"),null!=t.body&&(r=JSON.stringify(t.body));const c=yield fetch(e,{method:n,headers:o,body:"GET"==n?null:r}),a=yield c.text();try{return JSON.parse(a)}catch(e){throw new Error(a)}}))}const l="https://www.sonar-ext.com";(()=>{const e=new URL(l);e.protocol="wss:";let n=e.toString();n.endsWith("/")&&(n=n.slice(0,-1))})();var h=function(e,n,t,r){return new(t||(t=Promise))((function(o,c){function a(e){try{f(r.next(e))}catch(e){c(e)}}function i(e){try{f(r.throw(e))}catch(e){c(e)}}function f(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,i)}f((r=r.apply(e,n||[])).next())}))};chrome.runtime.onMessage.addListener(((e,n,t)=>{switch(e.endpoint){case"/customer":y(t,e);break;case"/capture":x(t,e);break;case"/login":w(t,e)}return!0}));const x=(e,n)=>h(void 0,void 0,void 0,(function*(){const{session:t}=yield chrome.storage.local.get("session"),{image:r}=yield b(`${l}/chat/capture`,"POST",{body:n.body,headers:[["Authorization",`Bearer ${t.token}`]]});e({body:{image:r}})})),y=(e,n)=>h(void 0,void 0,void 0,(function*(){var t;const{session:r}=yield chrome.storage.local.get("session"),o=yield b(`${l}/showcase/${null===(t=n.body)||void 0===t?void 0:t.username}`,"GET",{headers:[["Authorization",`Bearer ${r.token}`]]});e({body:o})})),w=(e,n)=>h(void 0,void 0,void 0,(function*(){const n=new URL("https://accounts.google.com/o/oauth2/auth"),t=chrome.runtime.getManifest(),r=chrome.identity.getRedirectURL("auth"),o=s(),c=t.oauth2.scopes.join(" ");n.searchParams.set("client_id",t.oauth2.client_id),n.searchParams.set("redirect_uri",r),n.searchParams.set("access_type","offline"),n.searchParams.set("response_type","code"),n.searchParams.set("include_granted_scopes","true"),n.searchParams.set("prompt","consent"),n.searchParams.set("state",o),n.searchParams.set("scope",c);const a=yield chrome.identity.launchWebAuthFlow({interactive:!0,url:n.href});if(chrome.runtime.lastError)throw new Error(chrome.runtime.lastError.message);const i=new URL(a),f=i.searchParams.get("code");if(o==i.searchParams.get("state")){console.log("authentication successfull");const n=yield function(e,n,t){return u(this,void 0,void 0,(function*(){let n,r=new Headers(t.headers);r.append("Content-Type","application/x-www-form-urlencoded"),null!=t.body&&(n=new URLSearchParams(t.body).toString());const o=null!=n?`${e}?${n}`:e,c=yield fetch(o,{method:"GET",headers:r,body:null}),a=yield c.text();try{return JSON.parse(a)}catch(e){throw new Error(a)}}))}(`${l}/auth`,0,{body:{code:f,redirect_uri:r}});yield chrome.storage.local.set({session:n}),e({body:n})}throw new Error("state did not match")}))})();